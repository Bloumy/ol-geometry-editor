!function(t){var e={};function o(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e){t.exports={tileLayers:[{url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}],hide:!0,editable:!0,width:"100%",height:"500",lon:2,lat:45,zoom:4,maxZoom:18,geometryType:"Geometry",centerOnResults:!0,onResult:function(){}}},function(t,e,o){(function(e){o(25),e.ge={defaultParams:o(0),GeometryEditor:o(3)},jQuery&&(jQuery.fn.geometryEditor=function(t){return this.each(function(){var o=new e.ge.GeometryEditor(this,t);$(this).data("editor",o)})}),t.exports=e.ge}).call(this,o(2))},function(t,e){var o;o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(o=window)}t.exports=o},function(t,e,o){var i=o(4),r=o(6),n=o(0),s=o(8),a=o(9),l=function(t,e){this.dataElement=$(t),this.settings={},$.extend(!0,this.settings,n,e),this.viewer=new a({geometryType:this.settings.geometryType}),this.map=this.initMap(),this.initDrawLayer(),this.settings.editable&&this.initDrawControls(),this.settings.hide&&this.dataElement.hide()};l.prototype.initMap=function(){return this.viewer.initMap({width:this.settings.width,height:this.settings.height,dataElement:this.dataElement,layers:this.settings.tileLayers,lon:this.settings.lon,lat:this.settings.lat,zoom:this.settings.zoom,maxZoom:this.settings.maxZoom,minZoom:this.settings.minZoom})},l.prototype.getMap=function(){return this.map},l.prototype.isDataElementAnInput=function(){return void 0!==this.dataElement.val},l.prototype.getRawData=function(){return this.isDataElementAnInput()?$.trim(this.dataElement.val()):$.trim(this.dataElement.html())},l.prototype.setRawData=function(t){this.getRawData()!==t&&(this.isDataElementAnInput()?this.dataElement.val(t):this.dataElement.html(t))},l.prototype.setGeometry=function(t){t instanceof Array&&4===t.length&&(t=i(t).geometry),this.viewer.removeFeatures(this.featuresCollection);var e=s(t);this.viewer.setGeometries(this.featuresCollection,e),this.settings.centerOnResults&&e.length>0&&this.viewer.fitViewToFeaturesCollection(this.featuresCollection),this.serializeGeometry()},l.prototype.initDrawLayer=function(){this.featuresCollection=this.viewer.createFeaturesCollection(),this.layer=this.viewer.addLayer(this.featuresCollection),this.updateDrawLayer(),this.dataElement.on("change",this.updateDrawLayer.bind(this))},l.prototype.updateDrawLayer=function(){var t,e=this.getRawData();if(""!==e)try{t=JSON.parse(e),this.setGeometry(t)}catch(t){return void this.viewer.removeFeatures(this.featuresCollection)}else this.viewer.removeFeatures(this.featuresCollection)},l.prototype.getGeometryType=function(){return this.settings.geometryType},l.prototype.initDrawControls=function(){var t={geometryType:this.getGeometryType(),featuresCollection:this.featuresCollection,translations:this.settings.translations};this.viewer.addDrawToolsControl(t);var e={onDrawCreated:function(t){this.settings.centerOnResults&&this.viewer.getFeaturesCount(this.featuresCollection)>0&&this.viewer.fitViewToFeaturesCollection(this.featuresCollection),this.serializeGeometry()}.bind(this),onDrawModified:function(t){this.settings.centerOnResults&&this.viewer.getFeaturesCount(this.featuresCollection)>0&&this.viewer.fitViewToFeaturesCollection(this.featuresCollection),this.serializeGeometry()}.bind(this),onDrawDeleted:function(t){this.serializeGeometry()}.bind(this)};this.viewer.addDrawToolsEvents(e)},l.prototype.serializeGeometry=function(){var t=this.viewer.getGeometryByFeaturesCollection(this.featuresCollection),e="";t&&(e="Rectangle"===this.getGeometryType()?JSON.stringify(r(t)):JSON.stringify(t)),this.settings.onResult(e),this.setRawData(e)},t.exports=l},function(t,e,o){var i=o(5);t.exports=function(t){var e=[t[0],t[1]],o=[t[0],t[3]],r=[t[2],t[3]],n=[t[2],t[1]];return i([[e,n,r,o,e]])}},function(t,e){t.exports=function(t,e){if(null===t)throw new Error("No coordinates passed");for(var o=0;o<t.length;o++)for(var i=t[o],r=0;r<i[i.length-1].length;r++){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}var n={type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:e};return n.properties||(n.properties={}),n}},function(t,e,o){var i=o(7).coordEach;t.exports=function(t){var e=[1/0,1/0,-1/0,-1/0];return i(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}},function(t,e){function o(t,e,o){var i,r,n,s,a,u,c,h,p,d=0,f="FeatureCollection"===t.type,y="Feature"===t.type,g=f?t.features.length:1;for(i=0;i<g;i++)for(u=(p="GeometryCollection"===(h=f?t.features[i].geometry:y?t.geometry:t).type)?h.geometries.length:1,s=0;s<u;s++)if(c=(a=p?h.geometries[s]:h).coordinates,d=!o||"Polygon"!==a.type&&"MultiPolygon"!==a.type?0:1,"Point"===a.type)e(c);else if("LineString"===a.type||"MultiPoint"===a.type)for(r=0;r<c.length;r++)e(c[r]);else if("Polygon"===a.type||"MultiLineString"===a.type)for(r=0;r<c.length;r++)for(n=0;n<c[r].length-d;n++)e(c[r][n]);else{if("MultiPolygon"!==a.type)throw new Error("Unknown Geometry Type");for(r=0;r<c.length;r++)for(n=0;n<c[r].length;n++)for(l=0;l<c[r][n].length-d;l++)e(c[r][n][l])}}function i(t,e){var o;switch(t.type){case"FeatureCollection":for(features=t.features,o=0;o<t.features.length;o++)e(t.features[o].properties);break;case"Feature":e(t.properties)}}t.exports.coordEach=o,t.exports.coordReduce=function(t,e,i,r){return o(t,function(t){i=e(i,t)},r),i},t.exports.propEach=i,t.exports.propReduce=function(t,e,o){return i(t,function(t){o=e(o,t)}),o}},function(t,e){t.exports=function(t){switch(t.type){case"Point":case"LineString":case"Polygon":return[t];case"MultiPoint":case"MultiLineString":case"MultiPolygon":return function(t){var e=[],o=t.type.substring("Multi".length);return t.coordinates.forEach(function(t){e.push({type:o,coordinates:t})}),e}(t);case"GeometryCollection":return function(t){var e=[];return t.geometries.forEach(function(t){e.push(t)}),e}(t);default:throw"unsupported geometry type : "+t.type}}},function(t,e,o){var i=o(10),r=o(20),n=o(21),s=o(23),a=o(24),l=function(t){this.settings={dataProjection:"EPSG:4326",mapProjection:"EPSG:3857"},$.extend(this.settings,t),this.initMap(this.settings)};l.prototype.initMap=function(t){var e="map-"+r(),o=$('<div id="'+e+'"></div>');o.addClass("map"),o.css("width",t.width),o.css("height",t.height),o.insertAfter(t.dataElement),this.map=this.createMap(e,t),this.addLayersToMap(t.layers)},l.prototype.getMap=function(){return this.map},l.prototype.addControl=function(t){this.getMap().addControl(t)},l.prototype.createMap=function(t,e){return e=e||{},new ol.Map({target:t,view:new ol.View({center:ol.proj.transform([e.lon,e.lat],this.settings.dataProjection,this.settings.mapProjection),zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom,projection:this.settings.mapProjection}),controls:[new ol.control.Zoom,new ol.control.Attribution]})},l.prototype.addLayersToMap=function(t){for(var e in t)this.getMap().addLayer(new ol.layer.Tile({source:new ol.source.XYZ({attributions:[t[e].attribution],url:t[e].url,crossOrigin:"Anonymous"})}))},l.prototype.setGeometries=function(t,e){for(var o in e){var i;switch(e[o].type){case"Point":i=new ol.geom.Point(e[o].coordinates);break;case"LineString":i=new ol.geom.LineString(e[o].coordinates);break;case"Polygon":i=new ol.geom.Polygon(e[o].coordinates);break;case"MultiPoint":i=new ol.geom.MultiPoint(e[o].coordinates);break;case"MultiLineString":i=new ol.geom.MultiLineString(e[o].coordinates);break;case"MultiPolygon":i=new ol.geom.MultiPolygon(e[o].coordinates)}var r=new ol.Feature({geometry:i.transform(this.settings.dataProjection,this.settings.mapProjection)}),n=this.settings.geometryType;"Geometry"===n&&(n=e[o].type),r.set("type",n),t.push(r)}this.getMap().dispatchEvent("set:geometries")},l.prototype.fitViewToFeaturesCollection=function(t){var e=[];t.forEach(function(t){e.push(t.getGeometry())}),this.getMap().getView().fit(new ol.geom.GeometryCollection(e).getExtent(),{size:this.getMap().getSize(),duration:100})},l.prototype.addLayer=function(t){var e=new ol.layer.Vector({source:new ol.source.Vector({features:t}),style:a});return this.getMap().addLayer(e),e},l.prototype.createFeaturesCollection=function(){return new ol.Collection},l.prototype.removeFeatures=function(t){t.clear()},l.prototype.getGeometryType=function(){return this.settings.geometryType},l.prototype.addDrawToolsControl=function(t){var e={featuresCollection:t.featuresCollection,type:t.geometryType,multiple:!s(t.geometryType),translations:t.translations},o=new i(e);this.getMap().on("set:geometries",function(){o.deactivateControls()}),this.addControl(o)},l.prototype.addDrawToolsEvents=function(t){this.getMap().on("draw:created",t.onDrawCreated),this.getMap().on("draw:edited",t.onDrawModified),this.getMap().on("draw:deleted",t.onDrawDeleted)},l.prototype.getGeometryByFeaturesCollection=function(t){var e=(new ol.format.GeoJSON).writeFeatures(t.getArray(),{featureProjection:this.settings.mapProjection,dataProjection:this.settings.dataProjection});return n(JSON.parse(e))},l.prototype.getFeaturesCount=function(t){return t.getLength()},t.exports=l},function(t,e,o){var i=o(11),r=o(12),n=o(13),s=o(16),a=o(17),l=o(19),u=function(t){this.translations=$.extend(i,t.translations||{}),this.featuresCollection=t.featuresCollection||new ol.Collection,this.type=t.type||"Geometry",this.multiple=t.multiple||!1,this.style=t.style,this.controls=[];var e=$("<div>").addClass("ol-draw-tools ol-unselectable ol-control");ol.control.Control.call(this,{element:e.get(0),target:t.target})};ol.inherits(u,ol.control.Control),u.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.initControl()},u.prototype.initControl=function(){this.addDrawControls(),this.addEditControl(),this.addTranslateControl(),this.addRemoveControl()},u.prototype.addDrawControls=function(){"Geometry"===this.type?(this.addDrawControl({type:"MultiPoint",multiple:!0,title:this.translations.draw.multipoint}),this.addDrawControl({type:"MultiLineString",multiple:!0,title:this.translations.draw.multilinestring}),this.addDrawControl({type:"MultiPolygon",multiple:!0,title:this.translations.draw.multipolygon})):this.addDrawControl({type:this.type,multiple:this.multiple,title:this.translations.draw[this.type.toLowerCase()]})},u.prototype.addDrawControl=function(t){t=t||{};var e=new r({featuresCollection:this.featuresCollection,type:t.type,target:this.element,style:function(e,o){return l(e,o,t.type)},multiple:t.multiple,title:t.title});e.on("draw:active",function(){this.deactivateControls(e)}.bind(this)),this.getMap().addControl(e),this.controls.push(e)},u.prototype.addEditControl=function(){var t=new n({featuresCollection:this.featuresCollection,target:this.element,title:this.translations.edit[this.type.toLowerCase()]});t.on("edit:active",function(){this.deactivateControls(t)}.bind(this)),this.getMap().addControl(t),this.controls.push(t)},u.prototype.addTranslateControl=function(){var t=new s({featuresCollection:this.featuresCollection,target:this.element,title:this.translations.translate[this.type.toLowerCase()]});t.on("translate:active",function(){this.deactivateControls(t)}.bind(this)),this.getMap().addControl(t),this.controls.push(t)},u.prototype.addRemoveControl=function(){var t=new a({featuresCollection:this.featuresCollection,target:this.element,title:this.translations.remove[this.type.toLowerCase()]});t.on("remove:active",function(){this.deactivateControls(t)}.bind(this)),this.getMap().addControl(t),this.controls.push(t)},u.prototype.deactivateControls=function(t){this.controls.forEach(function(e){e!==t&&e.setActive(!1)})},t.exports=u},function(t){t.exports={draw:{point:"Ajouter un point",multipoint:"Ajouter un ou plusieurs points",linestring:"Dessiner un chemin",multilinestring:"Ajouter un ou plusieurs chemins",polygon:"Dessiner un polygone",multipolygon:"Dessiner un ou plusieurs polygones",rectangle:"Dessiner une emprise"},edit:{point:"Modifier un point",multipoint:"Modifier un point",linestring:"Modifier un chemin",multilinestring:"Modifier un chemin",polygon:"Modifier un polygone",multipolygon:"Modifier un polygone",rectangle:"Modifier une emprise",geometry:"Modifier une gÃ©omÃ©trie"},translate:{point:"DÃ©placer un point",multipoint:"DÃ©placer un point",linestring:"DÃ©placer un chemin",multilinestring:"DÃ©placer un chemin",polygon:"DÃ©placer un polygone",multipolygon:"DÃ©placer un polygone",rectangle:"DÃ©placer une emprise",geometry:"DÃ©placer une gÃ©omÃ©trie"},remove:{point:"Supprimer un point",multipoint:"Supprimer un point",linestring:"Supprimer un chemin",multilinestring:"Supprimer un chemin",polygon:"Supprimer un polygone",multipolygon:"Supprimer un polygone",rectangle:"Supprimer une emprise",geometry:"Supprimer une gÃ©omÃ©trie"}}},function(t,e){var o=function(t){this.featuresCollection=t.featuresCollection,this.type=t.type||"Point",this.style=t.style,this.multiple=t.multiple,this.title=t.title||"Draw a "+this.type.toLowerCase();var e=$("<div>").addClass("ol-draw-"+this.type.toLowerCase()+" ol-unselectable ol-control");$("<button>").attr("title",this.title).on("touchstart click",function(t){t&&t.preventDefault&&t.preventDefault(),this.setActive(!this.active)}.bind(this)).appendTo(e),ol.control.Control.call(this,{element:e.get(0),target:t.target})};ol.inherits(o,ol.control.Control),o.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.initControl()},o.prototype.initControl=function(){this.addInteraction(),this.active=!1,this.setActive(this.active)},o.prototype.getActive=function(){return this.active},o.prototype.setActive=function(t){this.getInteraction().setActive(t),t&&!this.getActive()&&(this.dispatchEvent("draw:active"),$(this.element).addClass("active"),this.active=!0),!t&&this.getActive()&&(this.dispatchEvent("draw:inactive"),$(this.element).removeClass("active"),this.active=!1)},o.prototype.addInteraction=function(){var t={type:this.type,style:this.style,features:this.featuresCollection};"Square"===this.type&&(t.type="Circle",t.geometryFunction=ol.interaction.Draw.createRegularPolygon(4)),"Rectangle"===this.type&&(t.type="Circle",t.geometryFunction=ol.interaction.Draw.createBox());var e=new ol.interaction.Draw(t);e.on("drawend",function(t){this.multiple||this.featuresCollection.clear(),t.feature.set("type",this.type)}.bind(this)),this.featuresCollection.on("add",function(t){this.getMap().dispatchEvent($.extend(t,{type:"draw:created"}))}.bind(this)),this.getInteraction=function(){return e},this.getMap().addInteraction(e)},t.exports=o},function(t,e,o){var i=o(14),r=o(15),n=function(t){this.featuresCollection=t.featuresCollection,this.title=t.title||"Edit a feature";var e=$("<div>").addClass("ol-edit ol-unselectable ol-control");$("<button>").attr("title",this.title).on("touchstart click",function(t){t&&t.preventDefault&&t.preventDefault(),this.setActive(!this.active)}.bind(this)).appendTo(e),ol.control.Control.call(this,{element:e.get(0),target:t.target})};ol.inherits(n,ol.control.Control),n.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.initControl()},n.prototype.initControl=function(){this.addInteractions(),this.active=!1,this.setActive(this.active)},n.prototype.getActive=function(){return this.active},n.prototype.setActive=function(t){this.getInteractions().forEach(function(e){e.setActive(t)}),t&&!this.getActive()&&(this.dispatchEvent("edit:active"),$(this.element).addClass("active"),this.active=!0),!t&&this.getActive()&&(this.dispatchEvent("edit:inactive"),$(this.element).removeClass("active"),this.active=!1)},n.prototype.addInteractions=function(){this.reorganiseFeaturesCollectionByType();var t=new ol.interaction.Modify({features:this.getFeaturesCollectionBasic()}),e=new i({features:this.getFeaturesCollectionBox()}),o=new r({features:this.getFeaturesCollectionSquare()});this.getInteractions=function(){return[t,e,o]};var n=function(t){this.getMap().dispatchEvent($.extend(t,{type:"draw:edited"}))}.bind(this);this.getInteractions().forEach(function(t){t.on("modifyend",n),this.getMap().addInteraction(t)}.bind(this))},n.prototype.reorganiseFeaturesCollectionByType=function(){var t=new ol.Collection;this.getFeaturesCollectionBasic=function(){return t};var e=new ol.Collection;this.getFeaturesCollectionBox=function(){return e};var o=new ol.Collection;this.getFeaturesCollectionSquare=function(){return o};var i=function(i){switch(i.get("type")){case"Rectangle":e.push(i);break;case"Square":o.push(i);break;default:t.push(i)}};this.featuresCollection.forEach(i),this.featuresCollection.on("add",function(t){i(t.element)}),this.featuresCollection.on("remove",function(i){!function(i){switch(i.get("type")){case"Rectangle":e.remove(i);break;case"Square":o.remove(i);break;default:t.remove(i)}}(i.element)})},t.exports=n},function(t,e){var o=function(t){t=$.extend({features:null},t),this.features=t.features,this.coordinate_=null,this.grabCursor_="grab",this.grabbingCursor_="grabbing",this.feature_=null,this.previousCursor_=void 0;var e=new ol.style.Fill({color:[0,153,255,1]}),i=new ol.style.Stroke({color:[255,255,255,1],width:1.5}),r=new ol.style.Circle({fill:e,stroke:i,radius:6}),n=new ol.style.Style({image:r,fill:e,stroke:i});this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style||n,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.overlayPoints_=[],ol.interaction.Pointer.call(this,{handleDownEvent:o.prototype.handleDownEvent,handleDragEvent:o.prototype.handleDragEvent,handleMoveEvent:o.prototype.handleMoveEvent,handleUpEvent:o.prototype.handleUpEvent})};ol.inherits(o,ol.interaction.Pointer),o.prototype.handleDownEvent=function(t){this.deltaX=0,this.deltaY=0;var e=this.getFeatureUnderMouse_(t);if(e){this.coordinate_=t.coordinate,this.feature_=e;var o=t.map.getTargetElement();o.style.cursor!==this.grabbingCursor_&&(o.style.cursor=this.grabbingCursor_)}return!!e},o.prototype.handleDragEvent=function(t){var e=this.getFeature_(t);this.deltaX=t.coordinate[0]-this.coordinate_[0],this.deltaY=t.coordinate[1]-this.coordinate_[1],e.getGeometry().translate(this.deltaX,this.deltaY),t.map.getTargetElement().style.cursor=this.grabbingCursor_,this.handleModify_(t),this.coordinate_[0]=t.coordinate[0],this.coordinate_[1]=t.coordinate[1]},o.prototype.handleMoveEvent=function(t){var e=this.getFeatureUnderMouse_(t),o=t.map.getTargetElement();e?o.style.cursor!==this.grabCursor_&&(this.previousCursor_=o.style.cursor,o.style.cursor=this.grabCursor_):void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_,this.previousCursor_=void 0)},o.prototype.handleUpEvent=function(t){this.deltaX=0,this.deltaY=0;var e=t.map.getTargetElement();return this.feature_?e.style.cursor=this.grabCursor_:e.style.cursor=void 0,this.dispatchEvent({type:"modifyend",feature:this.feature_}),this.coordinate_=null,this.feature_=null,!1},o.prototype.handleModify_=function(t){var e=this.getFeatureOfModifyPoint_(this.feature_);e?this.setFeatureByModifyPoints_(e):this.moveModifyPointsWithFeature_()},o.prototype.setActive=function(t){ol.interaction.Pointer.prototype.setActive.call(this,t),t?this.enableModificationPoints(this.features):this.disableModificationPoints(this.features)},o.prototype.enableModificationPoints=function(t){null!==this.getMap()&&this.getMap().addLayer(this.overlay_),this.overlayPoints_=[],t.forEach(function(t){this.addModificationPoints_(t)}.bind(this))},o.prototype.disableModificationPoints=function(t){this.removeModificationPoints_(t)},o.prototype.removeModificationPoints_=function(t){for(var e in this.overlayPoints_)for(var o in this.overlayPoints_[e].modificationPoints)t.remove(this.overlayPoints_[e].modificationPoints[o]);this.overlay_.getSource().clear(),null!==this.getMap()&&this.getMap().removeLayer(this.overlay_),this.overlayPoints_=[]},o.prototype.addModificationPoints_=function(t){var e=t.getGeometry().getCoordinates()[0],o=[];for(var i in e)if("4"!==i){var r=new ol.Feature({geometry:new ol.geom.Point(e[i])});this.overlay_.getSource().addFeature(r),o[i]=r,this.features.push(r)}else o[i]=o[0];this.overlayPoints_.push({feature:t,modificationPoints:o})},o.prototype.getFeatureUnderMouse_=function(t){return t.map.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this))},o.prototype.getFeature_=function(t){return this.feature_},o.prototype.setFeatureByModifyPoints_=function(t){var e=this.getModifyPointsOfFeature_(t);this.updateLinkedModifyPointForBBox(this.feature_,e),this.redrawFeatureByModificationPointsPosition(t,e)},o.prototype.updateLinkedModifyPointForBBox=function(t,e){var o;for(var i in e)if(t===e[i]){o=parseInt(i);break}var r=o-1,n=o+1;0===o&&(r=3),3===o&&(n=0),o%2!=0?(e[r].getGeometry().translate(0,this.deltaY),e[n].getGeometry().translate(this.deltaX,0)):(e[r].getGeometry().translate(this.deltaX,0),e[n].getGeometry().translate(0,this.deltaY)),e[4].getGeometry().setCoordinates(e[0].getGeometry().getCoordinates())},o.prototype.redrawFeatureByModificationPointsPosition=function(t,e){var o=[];for(var i in e)o.push(e[i].getGeometry().getCoordinates());t.getGeometry().setCoordinates([o])},o.prototype.moveModifyPointsWithFeature_=function(){var t,e=this.getModifyPointsOfFeature_(this.feature_);switch(this.feature_.getGeometry().getType()){case"Polygon":(t=this.feature_.getGeometry().getCoordinates()[0]).pop()}for(var o in t)e[o].getGeometry().setCoordinates(t[o])},o.prototype.getFeatureOfModifyPoint_=function(t){for(var e in this.overlayPoints_)for(var o in this.overlayPoints_[e].modificationPoints)if(this.overlayPoints_[e].modificationPoints[o]===t)return this.overlayPoints_[e].feature},o.prototype.getModifyPointsOfFeature_=function(t){for(var e in this.overlayPoints_)if(this.overlayPoints_[e].feature===t)return this.overlayPoints_[e].modificationPoints},t.exports=o},function(t,e){var o=function(t){t=$.extend({features:null},t),this.features=t.features,this.coordinate_=null,this.grabCursor_="grab",this.grabbingCursor_="grabbing",this.feature_=null,this.previousCursor_=void 0,this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.overlayPoints_=[],ol.interaction.Pointer.call(this,{handleDownEvent:o.prototype.handleDownEvent,handleDragEvent:o.prototype.handleDragEvent,handleMoveEvent:o.prototype.handleMoveEvent,handleUpEvent:o.prototype.handleUpEvent})};ol.inherits(o,ol.interaction.Pointer),o.prototype.handleDownEvent=function(t){this.deltaX=0,this.deltaY=0;var e=this.getFeatureUnderMouse_(t);if(e){this.coordinate_=t.coordinate,this.feature_=e;var o=t.map.getTargetElement();o.style.cursor!==this.grabbingCursor_&&(o.style.cursor=this.grabbingCursor_)}return!!e},o.prototype.handleDragEvent=function(t){var e=this.getFeature_(t);this.deltaX=t.coordinate[0]-this.coordinate_[0],this.deltaY=t.coordinate[1]-this.coordinate_[1],e.getGeometry().translate(this.deltaX,this.deltaY),t.map.getTargetElement().style.cursor=this.grabbingCursor_,this.handleModify_(t),this.coordinate_[0]=t.coordinate[0],this.coordinate_[1]=t.coordinate[1]},o.prototype.handleMoveEvent=function(t){var e=this.getFeatureUnderMouse_(t),o=t.map.getTargetElement();e?o.style.cursor!==this.grabCursor_&&(this.previousCursor_=o.style.cursor,o.style.cursor=this.grabCursor_):void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_,this.previousCursor_=void 0)},o.prototype.handleUpEvent=function(t){this.deltaX=0,this.deltaY=0;var e=t.map.getTargetElement();return this.feature_?e.style.cursor=this.grabCursor_:e.style.cursor=void 0,this.dispatchEvent({type:"modifyend",feature:this.feature_}),this.coordinate_=null,this.feature_=null,!1},o.prototype.handleModify_=function(t){var e=this.getFeatureOfModifyPoint_(this.feature_);e?this.setFeatureByModifyPoints_(e):this.moveModifyPointsWithFeature_()},o.prototype.setActive=function(t){ol.interaction.Pointer.prototype.setActive.call(this,t),t?this.enableModificationPoints(this.features):this.disableModificationPoints(this.features)},o.prototype.enableModificationPoints=function(t){null!==this.getMap()&&this.getMap().addLayer(this.overlay_),this.overlayPoints_=[],t.forEach(function(t){this.addModificationPoints_(t)}.bind(this))},o.prototype.disableModificationPoints=function(t){this.removeModificationPoints_(t)},o.prototype.removeModificationPoints_=function(t){for(var e in this.overlayPoints_)for(var o in this.overlayPoints_[e].modificationPoints)t.remove(this.overlayPoints_[e].modificationPoints[o]);this.overlay_.getSource().clear(),null!==this.getMap()&&this.getMap().removeLayer(this.overlay_),this.overlayPoints_=[]},o.prototype.addModificationPoints_=function(t){var e=t.getGeometry().getCoordinates()[0],o=[];for(var i in e)if("4"!==i){var r=new ol.Feature({geometry:new ol.geom.Point(e[i])});this.overlay_.getSource().addFeature(r),o[i]=r,this.features.push(r)}else o[i]=o[0];this.overlayPoints_.push({feature:t,modificationPoints:o})},o.prototype.getFeatureUnderMouse_=function(t){return t.map.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this))},o.prototype.getFeature_=function(t){return this.feature_},o.prototype.setFeatureByModifyPoints_=function(t){var e=this.getModifyPointsOfFeature_(t);this.updateLinkedModifyPointForBBox(this.feature_,e),this.redrawFeatureByModificationPointsPosition(t,e)},o.prototype.updateLinkedModifyPointForBBox=function(t,e){var o;for(var i in e)if(t===e[i]){o=parseInt(i);break}var r=o-1,n=o+1;0===o&&(r=3),3===o&&(n=0),o%2!=0?(e[r].getGeometry().translate(0,this.deltaY),e[n].getGeometry().translate(this.deltaX,0)):(e[r].getGeometry().translate(this.deltaX,0),e[n].getGeometry().translate(0,this.deltaY)),e[4].getGeometry().setCoordinates(e[0].getGeometry().getCoordinates())},o.prototype.redrawFeatureByModificationPointsPosition=function(t,e){var o=[];for(var i in e)o.push(e[i].getGeometry().getCoordinates());t.getGeometry().setCoordinates([o])},o.prototype.moveModifyPointsWithFeature_=function(){var t,e=this.getModifyPointsOfFeature_(this.feature_);switch(this.feature_.getGeometry().getType()){case"Polygon":(t=this.feature_.getGeometry().getCoordinates()[0]).pop()}for(var o in t)e[o].getGeometry().setCoordinates(t[o])},o.prototype.getFeatureOfModifyPoint_=function(t){for(var e in this.overlayPoints_)for(var o in this.overlayPoints_[e].modificationPoints)if(this.overlayPoints_[e].modificationPoints[o]===t)return this.overlayPoints_[e].feature},o.prototype.getModifyPointsOfFeature_=function(t){for(var e in this.overlayPoints_)if(this.overlayPoints_[e].feature===t)return this.overlayPoints_[e].modificationPoints},t.exports=o},function(t,e){var o=function(t){this.title=t.title||"Move a geometry";var e=$("<div>").addClass("ol-translate ol-unselectable ol-control");$("<button>").attr("title",this.title).on("touchstart click",function(t){t&&t.preventDefault&&t.preventDefault(),this.setActive(!this.active)}.bind(this)).appendTo(e),ol.control.Control.call(this,{element:e.get(0),target:t.target})};ol.inherits(o,ol.control.Control),o.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.initControl()},o.prototype.initControl=function(){this.addTranslateInteraction(),this.active=!1,this.setActive(this.active)},o.prototype.getActive=function(){return this.active},o.prototype.setActive=function(t){this.getInteraction().setActive(t),t&&!this.getActive()&&(this.dispatchEvent("translate:active"),$(this.element).addClass("active"),this.active=!0),!t&&this.getActive()&&(this.dispatchEvent("translate:inactive"),$(this.element).removeClass("active"),this.active=!1)},o.prototype.addTranslateInteraction=function(){var t=new ol.interaction.Translate({hitTolerance:10});t.on("translateend",function(t){this.getMap().dispatchEvent($.extend(t,{type:"draw:edited"}))}.bind(this)),this.getMap().addInteraction(t),this.getInteraction=function(){return t}},t.exports=o},function(t,e,o){var i=o(18),r=function(t){this.featuresCollection=t.featuresCollection,this.title=t.title||"Remove a geometry";var e=$("<div>").addClass("ol-delete ol-unselectable ol-control");$("<button>").attr("title",this.title).on("touchstart click",function(t){t&&t.preventDefault&&t.preventDefault(),this.setActive(!this.active)}.bind(this)).appendTo(e),ol.control.Control.call(this,{element:e.get(0),target:t.target})};ol.inherits(r,ol.control.Control),r.prototype.setMap=function(t){ol.control.Control.prototype.setMap.call(this,t),this.initControl()},r.prototype.initControl=function(){this.addInteraction(),this.active=!1,this.setActive(this.active)},r.prototype.getActive=function(){return this.active},r.prototype.setActive=function(t){this.getInteraction().setActive(t),t&&!this.getActive()&&(this.dispatchEvent("remove:active"),$(this.element).addClass("active"),this.active=!0),!t&&this.getActive()&&(this.dispatchEvent("remove:inactive"),$(this.element).removeClass("active"),this.active=!1)},r.prototype.addInteraction=function(){var t=new i({features:this.featuresCollection});this.getInteraction=function(){return t},t.on("deleteend",function(t){this.getMap().dispatchEvent($.extend(t,{type:"draw:deleted"}))}.bind(this)),this.getMap().addInteraction(t)},t.exports=r},function(t,e){var o=function(t){t=$.extend({features:null},t),ol.interaction.Pointer.call(this,{handleDownEvent:o.prototype.handleDownEvent,handleDragEvent:o.prototype.handleDragEvent,handleMoveEvent:o.prototype.handleMoveEvent,handleUpEvent:o.prototype.handleUpEvent}),this.features=t.features,this.pointerCursor_="pointer",this.feature_=null,this.previousCursor_=void 0};ol.inherits(o,ol.interaction.Pointer),o.prototype.handleDownEvent=function(t){var e=t.map.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this));return this.feature_=e,!!e},o.prototype.handleDragEvent=function(t){var e=t.map.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this)),o=t.map.getTargetElement();e?o.style.cursor!=this.pointerCursor_&&(this.previousCursor_=o.style.cursor,o.style.cursor=this.pointerCursor_):void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_,this.previousCursor_=void 0)},o.prototype.handleMoveEvent=function(t){var e=t.map.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this)),o=t.map.getTargetElement();e?o.style.cursor!=this.pointerCursor_&&(this.previousCursor_=o.style.cursor,o.style.cursor=this.pointerCursor_):void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_,this.previousCursor_=void 0)},o.prototype.handleUpEvent=function(t){var e=t.map,o=(e.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())this.features.getArray()[e]===t&&this.feature_===t&&this.features.remove(t)}.bind(this)),e.forEachFeatureAtPixel(t.pixel,function(t){for(var e in this.features.getArray())if(this.features.getArray()[e]===t)return t}.bind(this))),i=t.map.getTargetElement();return o?i.style.cursor=this.pointerCursor_:void 0!==i.style.cursor&&(i.style.cursor=void 0),this.dispatchEvent({type:"deleteend"}),!1},t.exports=o},function(t,e){t.exports=function(t,e,o){switch(o){case"Point":case"MultiPoint":var i=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,41],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:1,src:"../dist/images/marker-icon.png"})});return[new ol.style.Style({image:new ol.style.Icon({anchor:[14,41],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:"../dist/images/marker-shadow.png"})}),i]}return function(){var t=new ol.style.Fill({color:"rgba(255,255,255,0.4)"}),e=new ol.style.Stroke({color:"#3399CC",width:1.25}),o=new ol.style.Circle({fill:t,stroke:e,radius:5});return[new ol.style.Style({image:o,fill:t,stroke:e})]}()}},function(t,e){t.exports=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},function(t,e,o){var i=o(22);t.exports=function(t){var e=[];return t.features.forEach(function(t){e.push(t.geometry)}),0===e.length?null:1==e.length?e[0]:i(e)}},function(t,e){t.exports=function(t){var e={};if(t.forEach(function(t){void 0===e[t.type]?e[t.type]=1:e[t.type]++}),Object.keys(e).length>1)return{type:"GeometryCollection",geometries:t};var o="Multi"+Object.keys(e)[0],i=[];return t.forEach(function(t){i.push(t.coordinates)}),{type:o,coordinates:i}}},function(t,e){t.exports=function(t){return-1!==["Point","LineString","Polygon","Rectangle"].indexOf(t)}},function(t,e){t.exports=function(t,e){switch(type=t.getGeometry().getType(),type){case"Point":case"MultiPoint":var o=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,41],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:1,src:"../dist/images/marker-icon.png"})});return[new ol.style.Style({image:new ol.style.Icon({anchor:[14,41],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:"../dist/images/marker-shadow.png"})}),o]}return function(){var t=new ol.style.Fill({color:"rgba(255,255,255,0.4)"}),e=new ol.style.Stroke({color:"#3399CC",width:1.25}),o=new ol.style.Circle({fill:t,stroke:e,radius:5});return[new ol.style.Style({image:o,fill:t,stroke:e})]}()}},function(t,e){}]);